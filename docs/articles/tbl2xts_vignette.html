<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moving From Tbl To Xts Easily • tbl2xts</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Moving From Tbl To Xts Easily">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tbl2xts</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tbl2xts_vignette.html">Moving From Tbl To Xts Easily</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Moving From Tbl To Xts Easily</h1>
                        <h4 class="author">NF Katzke</h4>
            
            <h4 class="date">2019-08-01</h4>
      
      
      <div class="hidden name"><code>tbl2xts_vignette.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The aim of this package is to help users move from tidyverse to xts environments more easily. In particular, users that want to put data.frame or tbl_df objects into xts format will find this package useful. Xts is a powerful package used to convert dataframes into time-series. This package is widely used in other packages in R too.</p>
<p>The problem is that often times users want to move from a tbl format, or a tidyverse format, into xts, but doing so can be an onerous task. This package aims to overcome this problem by bridging the tbl_df or data.table to xts gap. It also allows the user to use a spread_by argument for an easy character column xts conversion for tidy data.</p>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h1>
<p>To illustrate the ease with which tbl2xts transforms data.frames or tbl_dfs into xts format, consider the following example.</p>
<div id="example-1" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example 1</h2>
<p>Load the tbl_df data set included with the package, and transform it into xts format.</p>
<pre><code>library(dplyr)
library(tbl2xts)
tbldata &lt;- TRI
xtsdata &lt;- tbldata %&gt;% 
tbl_xts(., cols_to_xts = "TRI", spread_by = "Country", spread_name_pos = "Suffix")</code></pre>
<p>Notice that the column name convention is to use the spread_by name, underscore, column name. In the example above, it is Country_TRI.</p>
<div id="to-now-transform-the-xts-object-back-into-a-tbl_df-object-simply-use-the-inverse-command" class="section level3">
<h3 class="hasAnchor">
<a href="#to-now-transform-the-xts-object-back-into-a-tbl_df-object-simply-use-the-inverse-command" class="anchor"></a>To now transform the xts object back into a tbl_df() object, simply use the inverse command:</h3>
<pre><code>xtsdata %&gt;% xts_tbl()</code></pre>
</div>
</div>
<div id="example-2" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2" class="anchor"></a>Example 2</h2>
<p>tbl_xts also facilitates the use of tbl_df dataframes in packages that use xts. As an illustration, see the output for TRI with the package PerformanceAnalytics. As we are working with Total Return Index values, suppose we wanted to calculate the weekly returns, and then the … using PerformanceAnalytics. This can now be achieved with neat code as follows:</p>
<pre><code>library(dplyr)
library(tbl2xts)
library(PerformanceAnalytics)
tbldata &lt;- TRI
tbldata %&gt;% 
tbl_xts(., cols_to_xts = "TRI", spread_by = "Country") %&gt;% 
lapply(.,Return.calculate, "discrete") %&gt;% Reduce(merge,.) %&gt;% table.DownsideRisk(.)</code></pre>
<p>Note that lapply was used to apply the Return.Calculate to each column, while Reduce was used to merge all the lists created using lapply into a single dataframe. We then pipe all the returns into, e.g., the table.DownsideRisk function, or any other applicable function in the PA package.</p>
</div>
<div id="example-3" class="section level2">
<h2 class="hasAnchor">
<a href="#example-3" class="anchor"></a>Example 3:</h2>
<p>Here I show how you can easily do quite advanced calculations and seemlessly move from tbl to xts back to tbl. Below I use xts’ apply.yearly and PerformanceAnalytics’ suite of calcs that allow us to do some nice calculations easily:</p>
<pre><code>TRI %&gt;% tbl_xts(., spread_by = "Country") %&gt;%  
PerformanceAnalytics::Return.calculate(.) %&gt;% 
xts::apply.yearly(., FUN = PerformanceAnalytics::StdDev.annualized) %&gt;% 
xts_tbl</code></pre>
<p>Note how easy we could do quite advanced calculations in a single pipe. E.g. if tasked with producing a plot for the annual CVaR numbers for our countries:</p>
<pre><code>library(ggplot2)
library(tidyr)
TRI %&gt;% tbl_xts(., spread_by = "Country") %&gt;%  
PerformanceAnalytics::Return.calculate(.) %&gt;% 
xts::apply.yearly(., FUN = PerformanceAnalytics::CVaR) %&gt;% 
xts_tbl %&gt;% tidyr::gather(Country, CVaR, -date) %&gt;% 
ggplot() + geom_line(aes(date, CVaR)) + theme_bw() + facet_wrap(~Country)</code></pre>
</div>
<div id="note" class="section level2">
<h2 class="hasAnchor">
<a href="#note" class="anchor"></a>Note</h2>
<p>The input requires the data to be in data.frame() or tbl_df() form, with a valid date column being provided (similar to the requirement for the xts package). The function will check if a column date, DATE, or Date exists, or alternatively look for a valid timeBased object in your worfkile and rename it Date. This column can be either a Date, POSIXct, chron, yearmon, yearqtr or timeDate (see ?timeBased) column. The validity of the date column can be tested using:</p>
<pre><code>library(dplyr)
library(tbl2xts)
data(TRI)
TRI[,"Date"] %&gt;% .[[1]] %&gt;% timeBased()</code></pre>
<p>If TRUE, it is a valid date column.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#examples">Examples</a><ul class="nav nav-pills nav-stacked">
<li><a href="#example-1">Example 1</a></li>
      <li><a href="#example-2">Example 2</a></li>
      <li><a href="#example-3">Example 3:</a></li>
      <li><a href="#note">Note</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nico Katzke.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
